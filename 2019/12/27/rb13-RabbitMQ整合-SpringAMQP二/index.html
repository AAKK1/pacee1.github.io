<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="rabbitmq," />










<meta name="description" content="接着上一节，我们研究剩下的核心内容 SimpleMessageListenerContainer消息监听容器，其作用和消费者差不多，可以根据一系列的配置，进行消息的消费，主要作用有：  监听队列（多个），自启动，自动声明 设置事物相关 设置消费者数量，最大数量，批量消费 设置消息确认模式，是否自动签收（ACK），是否重回队列 设置消费者Tag标签的生成策略（UUID），是否独占以及其他属性 设置具">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMQ整合-SpringAMQP(二)">
<meta property="og:url" content="http://yoursite.com/2019/12/27/rb13-RabbitMQ%E6%95%B4%E5%90%88-SpringAMQP%E4%BA%8C/index.html">
<meta property="og:site_name" content="PAcee Hub">
<meta property="og:description" content="接着上一节，我们研究剩下的核心内容 SimpleMessageListenerContainer消息监听容器，其作用和消费者差不多，可以根据一系列的配置，进行消息的消费，主要作用有：  监听队列（多个），自启动，自动声明 设置事物相关 设置消费者数量，最大数量，批量消费 设置消息确认模式，是否自动签收（ACK），是否重回队列 设置消费者Tag标签的生成策略（UUID），是否独占以及其他属性 设置具">
<meta property="og:image" content="http://yoursite.com/image/1577410189949.png">
<meta property="og:image" content="http://yoursite.com/image/1577410390009.png">
<meta property="og:image" content="http://yoursite.com/image/1577414515662.png">
<meta property="og:image" content="http://yoursite.com/image/1577415069829.png">
<meta property="og:image" content="http://yoursite.com/image/1577415948186.png">
<meta property="og:image" content="http://yoursite.com/image/1577417683728.png">
<meta property="og:image" content="http://yoursite.com/image/1577431818943.png">
<meta property="og:image" content="http://yoursite.com/image/1577433001376.png">
<meta property="og:image" content="http://yoursite.com/image/1577433592956.png">
<meta property="og:image" content="http://yoursite.com/image/1577435022238.png">
<meta property="og:image" content="http://yoursite.com/image/1577435037828.png">
<meta property="article:published_time" content="2019-12-27T09:58:40.000Z">
<meta property="article:modified_time" content="2019-12-27T10:00:01.511Z">
<meta property="article:author" content="PAcee">
<meta property="article:tag" content="rabbitmq">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/image/1577410189949.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/12/27/rb13-RabbitMQ整合-SpringAMQP二/"/>





  <title>RabbitMQ整合-SpringAMQP(二) | PAcee Hub</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">PAcee Hub</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习 笔记</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/27/rb13-RabbitMQ%E6%95%B4%E5%90%88-SpringAMQP%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PAcee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PAcee Hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">RabbitMQ整合-SpringAMQP(二)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-27T17:58:40+08:00">
                2019-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/rabbitmq/" itemprop="url" rel="index">
                    <span itemprop="name">rabbitmq</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>接着上一节，我们研究剩下的核心内容</p>
<h2 id="SimpleMessageListenerContainer"><a href="#SimpleMessageListenerContainer" class="headerlink" title="SimpleMessageListenerContainer"></a>SimpleMessageListenerContainer</h2><p>消息监听容器，其作用和消费者差不多，可以根据一系列的配置，进行消息的消费，主要作用有：</p>
<ul>
<li>监听队列（多个），自启动，自动声明</li>
<li>设置事物相关</li>
<li>设置消费者数量，最大数量，批量消费</li>
<li>设置消息确认模式，是否自动签收（<code>ACK</code>），是否重回队列</li>
<li>设置消费者<code>Tag</code>标签的生成策略（<code>UUID</code>），是否独占以及其他属性</li>
<li>设置具体的监听、消息转换器，适配器</li>
</ul>
<h3 id="特性说明"><a href="#特性说明" class="headerlink" title="特性说明"></a>特性说明</h3><ul>
<li><code>SimpleMessageListenerContainer</code>可以进行动态设置， 比如在运行中的应用可以动态的修改其消费者数量的大小、接收消息的模式等</li>
<li>很多基于RabbitMQ的自制定化后端管控台在进行动态设置的时候，也是根据这一特去实现的。所以可以看出SpringAMQP非常的强大<a id="more"></a>
<h3 id="SimpleMessageListenerContainer使用"><a href="#SimpleMessageListenerContainer使用" class="headerlink" title="SimpleMessageListenerContainer使用"></a>SimpleMessageListenerContainer使用</h3></li>
</ul>
<p>和之前一样，也需要向容器中添加，简单设置一些常用属性，还有一些比如适配器，转换器后面再使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SimpleMessageListenerContainer <span class="title">simpleMessageListenerContainer</span><span class="params">(ConnectionFactory connectionFactory)</span></span>&#123;</span><br><span class="line">    SimpleMessageListenerContainer container = <span class="keyword">new</span> SimpleMessageListenerContainer(connectionFactory);</span><br><span class="line">    <span class="comment">//监控队列，可以同时监控多个</span></span><br><span class="line">    container.setQueueNames(<span class="string">"spring.ann.direct.queue"</span>,<span class="string">"spring.ann.direct.queue2"</span>); <span class="comment">// 通过名字设置队列</span></span><br><span class="line">    <span class="comment">// container.setQueues(); // 通过队列对象设置</span></span><br><span class="line">    <span class="comment">//设置当前消费者数量</span></span><br><span class="line">    container.setConcurrentConsumers(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//设置消费者并发数量的上限，不能小于ConcurrentConsumers，默认为ConcurrentConsumers，消费者会按需添加</span></span><br><span class="line">    <span class="comment">//指的是消费者的最大并行度是多少</span></span><br><span class="line">    container.setMaxConcurrentConsumers(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">//设置是否重回队列</span></span><br><span class="line">    container.setDefaultRequeueRejected(<span class="keyword">false</span>);</span><br><span class="line">    <span class="comment">//设置签收模式：AUTO(自动签收)、MANUAL(手工签收)、NONE(不签收，没有任何操作)</span></span><br><span class="line">    container.setAcknowledgeMode(AcknowledgeMode.AUTO);</span><br><span class="line">    <span class="comment">//设置消费端标签策略：就是在消费端生成自己的标签时可以指定一个生成策略</span></span><br><span class="line">    container.setConsumerTagStrategy(<span class="keyword">new</span> ConsumerTagStrategy() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">createConsumerTag</span><span class="params">(String queue)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> queue + <span class="string">"_"</span> + UUID.randomUUID().toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置消息监听器</span></span><br><span class="line">    container.setMessageListener(<span class="keyword">new</span> ChannelAwareMessageListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            String msg = <span class="keyword">new</span> String(message.getBody());</span><br><span class="line">            System.err.println(<span class="string">"----------消费者: "</span> + msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> container;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里当设置消息监听器后，启动程序便不会自动关闭了，而是一直处于监听状态</p>
<p><img src="/image/1577410189949.png" alt="1577410189949"></p>
<p>启动后会发现信道中有一个<code>Consumer</code>，就是我们刚刚设置的<code>Consumer</code>，并且<code>tag</code>标签是<code>UUID</code>生成的</p>
<p>这时我们向次队列发送消息，看看是否会被消费，关闭<code>Application</code>，并启动Test测试类发送</p>
<p><img src="/image/1577410390009.png" alt="1577410390009"></p>
<p>成功消费四条，这里为何要启动测试类发送呢？因为我们是使用<code>@Bean</code>直接将监听容器添加到上下文了，所以启动Test类会自动加载并监听消费。</p>
<h2 id="MessageListenerAdapter"><a href="#MessageListenerAdapter" class="headerlink" title="MessageListenerAdapter"></a>MessageListenerAdapter</h2><p>消息监听适配器，使用了适配器模式，需要我们自己创建一个类，使用我们创建的来进行实际的消息消费。</p>
<p>消息监听适配器也是基于<code>SimpleMessageListenerContainer</code>添加的，需要在<code>Container</code>中设置，使用消息监听适配器，就不需要添加<code>ChannelAwareMessageListener</code>了，这种方式进行消息消费，更加灵活</p>
<h3 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h3><p>1.首先创建一个我们的Adapter类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(<span class="keyword">byte</span>[] body)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"handleMesage : "</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里只添加了一个<code>handleMessage(byte[])</code>方法，为何叫这名字，为何使用<code>byte</code>数组参数，我们后面在说</p>
<p>2.然后再<code>Container</code>中创建适配器，并添加此适配器监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建消息监听适配器</span></span><br><span class="line">MessageListenerAdapter adapter = <span class="keyword">new</span> MessageListenerAdapter(<span class="keyword">new</span> MyAdapter());</span><br><span class="line"><span class="comment">// 添加消息监听适配器</span></span><br><span class="line">container.setMessageListener(adapter);</span><br></pre></td></tr></table></figure>

<p>3.最后在测试类发送一条消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// Message的Properties配置</span></span><br><span class="line">    MessageProperties messageProperties = <span class="keyword">new</span> MessageProperties();</span><br><span class="line">    messageProperties.setHeader(<span class="string">"desc"</span>,<span class="string">"一些信息"</span>); <span class="comment">// 添加Header</span></span><br><span class="line">    String msg = <span class="string">"hello rabbitTemplate"</span>;</span><br><span class="line">    <span class="comment">// 创建消息</span></span><br><span class="line">    Message message = <span class="keyword">new</span> Message(msg.getBytes(),messageProperties);</span><br><span class="line">    <span class="comment">// 发送一条消息 投递到spring.ann.direct Exchange上，路由键为ann.direct</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">"spring.ann.direct"</span>,<span class="string">"ann.direct"</span>,message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看控制台</p>
<p><img src="/image/1577414515662.png" alt="1577414515662"></p>
<p>发现正确把消息消费了</p>
<h3 id="源码查看"><a href="#源码查看" class="headerlink" title="源码查看"></a>源码查看</h3><p>接着我们进入源码，看看他为何使用这种方法名与参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageListenerAdapter</span> <span class="keyword">extends</span> <span class="title">AbstractAdaptableMessageListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; queueOrTagToMethodName = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Out-of-the-box value for the default listener method: "handleMessage".</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ORIGINAL_DEFAULT_LISTENER_METHOD = <span class="string">"handleMessage"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Object delegate;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String defaultListenerMethod = ORIGINAL_DEFAULT_LISTENER_METHOD;</span><br></pre></td></tr></table></figure>

<p>重要的成员变量就这四个</p>
<ul>
<li><code>queueOrTagToMethodName</code>：队列与方法名对应，后面再讲</li>
<li><code>defaultListenerMethod</code>配合<code>ORIGINAL_DEFAULT_LISTENER_METHOD</code>：默认方法名为<code>handleMessage</code></li>
<li><code>delegate</code>：传入的适配器，即我们的<code>MyAdapter</code>类对象</li>
</ul>
<p>通过几个成员变量就可以发现，底层<strong>使用反射机制对传入的适配对象的默认方法名进行调用</strong>，而这里默认方法名就是<code>handleMessage</code></p>
<h3 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h3><h4 id="方法名修改"><a href="#方法名修改" class="headerlink" title="方法名修改"></a>方法名修改</h4><p>1.首先是默认方法名修改，这里需要使用setDefaultListenerMethod()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adapter.setDefaultListenerMethod(<span class="string">"consumerMessage"</span>);</span><br></pre></td></tr></table></figure>

<p>2.在MyAdapter中添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumerMessage</span><span class="params">(<span class="keyword">byte</span>[] body)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"consumeMessage : "</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.发送消息</p>
<p><img src="/image/1577415069829.png" alt="1577415069829"></p>
<p>成功执行调用</p>
<h4 id="方法参数类型修改"><a href="#方法参数类型修改" class="headerlink" title="方法参数类型修改"></a>方法参数类型修改</h4><p>因为我们的消息是默认由<code>byte[]</code>数组保存，所以方法参数上要使用<code>byte</code>数组，那么如何修改它呢，比如改成String，就需要用到之后要讲的消息转换器<code>MessageConverter</code>，将<code>Message</code>转换成String类型的，使用<code>Adapter</code>的<code>setMessageConverter(MessageConverter)</code>方法配置转换器</p>
<p>1.创建一个自定义消息转换器并实现<code>MessageConverter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConverter</span> <span class="keyword">implements</span> <span class="title">MessageConverter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 将Object对象转成Message对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Message <span class="title">toMessage</span><span class="params">(Object object, MessageProperties messageProperties)</span> <span class="keyword">throws</span> MessageConversionException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Message(object.toString().getBytes(),messageProperties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 将Message对象转成String 这里我们主要使用这个方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">fromMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> MessageConversionException </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] body = message.getBody();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(body);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.在<code>MyAdapter</code>创建一个<code>String</code>参数的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumerMessage</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"consumeMessage String : "</span> + msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.配置消息转换器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adapter.setMessageConverter(<span class="keyword">new</span> MyConverter());</span><br></pre></td></tr></table></figure>

<p>4.发送消息，查看控制台</p>
<p><img src="/image/1577415948186.png" alt="1577415948186"></p>
<p>正确请求String类型入参的消费方法</p>
<h4 id="队列与方法对应"><a href="#队列与方法对应" class="headerlink" title="队列与方法对应"></a>队列与方法对应</h4><p>这时我们就会发现，在刚刚所有的消费看了，不管发送消息到哪个队列（<code>container.setQueueNames(&quot;spring.ann.direct.queue&quot;,&quot;spring.ann.direct.queue2&quot;);</code>中配置的队列），都会被默认方法消费，那么我们想对应消费的方法应该怎么做呢，就要用到之前源码分析看到的<code>queueOrTagToMethodName</code>参数。</p>
<p>1.适配器进行修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建消息监听适配器</span></span><br><span class="line">MessageListenerAdapter adapter = <span class="keyword">new</span> MessageListenerAdapter(<span class="keyword">new</span> MyAdapter());</span><br><span class="line"><span class="comment">//adapter.setDefaultListenerMethod("consumerMessage");</span></span><br><span class="line"><span class="comment">//adapter.setMessageConverter(new MyConverter());</span></span><br><span class="line">Map&lt;String,String&gt; queueToMethod = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">queueToMethod.put(<span class="string">"spring.ann.direct.queue"</span>,<span class="string">"method01"</span>);</span><br><span class="line">queueToMethod.put(<span class="string">"spring.ann.direct.queue2"</span>,<span class="string">"method02"</span>);</span><br><span class="line">adapter.setQueueOrTagToMethodName(queueToMethod);</span><br><span class="line"><span class="comment">// 添加消息监听适配器</span></span><br><span class="line">container.setMessageListener(adapter);</span><br></pre></td></tr></table></figure>

<p>2.在MyAdapter中添加对应方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method01</span><span class="params">(<span class="keyword">byte</span>[] body)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"method 01 : "</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method02</span><span class="params">(String body)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"method 02 : "</span> + body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.发送消息到队列上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MessageProperties messageProperties = <span class="keyword">new</span> MessageProperties();</span><br><span class="line">        String msg = <span class="string">"spring.ann.direct msg"</span>;</span><br><span class="line">        <span class="comment">// 创建消息</span></span><br><span class="line">        Message message = <span class="keyword">new</span> Message(msg.getBytes(),messageProperties);</span><br><span class="line">        <span class="comment">// 发送一条消息 投递到spring.ann.direct Exchange上，路由键为ann.direct</span></span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"spring.ann.direct"</span>,<span class="string">"ann.direct"</span>,message);</span><br><span class="line">        <span class="comment">// 简单的发送一条字符串信息</span></span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"spring.ann.direct2"</span>,<span class="string">"ann.direct"</span>,<span class="string">"hh"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这里我们第一条发送<code>Message</code>对象，方法中使用<code>byte</code>数组接收，第二条消息发送<code>String</code>对象，使用<code>String</code>接收</p>
<p><img src="/image/1577417683728.png" alt="1577417683728"></p>
<p>正确消费</p>
<h2 id="MessageConverter"><a href="#MessageConverter" class="headerlink" title="MessageConverter"></a>MessageConverter</h2><p>消息转换器，在消息传输中，默认都是使用二进制字节流的方式进行传输，就是<code>byte[]</code>数组的方式，在上面消息适配器的学习中，我们使用了自定义的消息转换器，使消息使用字符串形式进行投递并消费，这里我们再了解下其他一些常用的消息转换器。</p>
<p>对于自定义转换器，实现方法为：</p>
<ul>
<li>实现<code>MessageConverter</code>接口，重写下面两个方法<ul>
<li><code>toMessage:</code> java对象转换为Message</li>
<li><code>fromMessage:</code> Message对象转换为java对象</li>
</ul>
</li>
</ul>
<p>常用的转换器：</p>
<ul>
<li><code>Jackson2JsonMessageConverter</code>：对Json进行转换，配合<code>DefaultJackson2JavaTypeMapper</code>可以对<code>JavaBean</code>进行转换</li>
<li><code>ContentTypeDelegatingMessageConverter</code>：全局转换器，可以设置多种转换器组合</li>
</ul>
<h3 id="Jackson2JsonMessageConverter"><a href="#Jackson2JsonMessageConverter" class="headerlink" title="Jackson2JsonMessageConverter"></a>Jackson2JsonMessageConverter</h3><h4 id="Message转Json"><a href="#Message转Json" class="headerlink" title="Message转Json"></a>Message转Json</h4><p><strong>1.创建一个<code>User</code>Bean，这里我就不放代码了，简单的<code>id</code>与<code>name</code>字段</strong></p>
<p><strong>2.添加Bean转Json依赖，这里我添加了阿里的fastjson</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- alibaba json --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3.修改监听容器代码，将Json转换器绑定到适配器上</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SimpleMessageListenerContainer <span class="title">simpleMessageListenerContainer2</span><span class="params">(ConnectionFactory connectionFactory)</span></span>&#123;</span><br><span class="line">    SimpleMessageListenerContainer container = <span class="keyword">new</span> SimpleMessageListenerContainer(connectionFactory);</span><br><span class="line">    container.setQueueNames(<span class="string">"spring.ann.direct.queue"</span>); <span class="comment">// 通过名字设置队列</span></span><br><span class="line">    container.setConcurrentConsumers(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建消息监听适配器</span></span><br><span class="line">    MessageListenerAdapter adapter = <span class="keyword">new</span> MessageListenerAdapter(<span class="keyword">new</span> MyAdapter());</span><br><span class="line">    adapter.setDefaultListenerMethod(<span class="string">"consumerMessage"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Json转换</span></span><br><span class="line">    Jackson2JsonMessageConverter converter = <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">    <span class="comment">// 设置转换器</span></span><br><span class="line">    adapter.setMessageConverter(converter);</span><br><span class="line"></span><br><span class="line">    container.setMessageListener(adapter);</span><br><span class="line">    <span class="keyword">return</span> container;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特别注意，在适配器上添加转换器，而不是<code>container</code>容器中<code>set</code>转换器</p>
<p><strong>4.修改委派类`MyAdapter</strong>`</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收Json格式的</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumerMessage</span><span class="params">(Map jsonMap)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"jsonMessage : "</span> + jsonMap);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里添加一个接受Json格式的重载方法，Json格式消费时会以Map形式接收</p>
<p><strong>5.发送消息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// Json Message Send</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendJsonMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">"pacee"</span>);</span><br><span class="line">    String userJson = JSONObject.toJSONString(user);</span><br><span class="line">    <span class="comment">// 创建消息</span></span><br><span class="line">    <span class="comment">// 配置json格式请求</span></span><br><span class="line">    MessageProperties messageProperties = <span class="keyword">new</span> MessageProperties();</span><br><span class="line">    messageProperties.setContentType(<span class="string">"application/json"</span>);</span><br><span class="line">    Message message = <span class="keyword">new</span> Message(userJson.getBytes(),messageProperties);</span><br><span class="line">    <span class="comment">// 发送一条消息 投递到spring.ann.direct Exchange上，路由键为ann.direct</span></span><br><span class="line">    rabbitTemplate.send(<span class="string">"spring.ann.direct"</span>,<span class="string">"ann.direct"</span>,message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发送消息时特别注意，要加上<code>setContentType(&quot;application/json&quot;)</code>，不然还是以<code>byte</code>二进制字节流形式传输的</p>
<p><strong>6.查看结果</strong></p>
<p><img src="/image/1577431818943.png" alt="1577431818943"></p>
<p>成功以Json形式接收</p>
<h4 id="Message转ObjecBean"><a href="#Message转ObjecBean" class="headerlink" title="Message转ObjecBean"></a>Message转ObjecBean</h4><p>这里是直接使用ObjectBean进行传输，即我们刚刚创建的User对象</p>
<p><strong>1.修改委派类MyAdapter</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收User格式的</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumerMessage</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"userMessage : "</span> + user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加User类型的重载方法用来接收消息</p>
<p><strong>2.修改发送消息测试类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendUserMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">"pacee"</span>);</span><br><span class="line">    String userJson = JSONObject.toJSONString(user);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建消息</span></span><br><span class="line">    <span class="comment">// 配置json格式请求</span></span><br><span class="line">    MessageProperties messageProperties = <span class="keyword">new</span> MessageProperties();</span><br><span class="line">    messageProperties.setContentType(<span class="string">"application/json"</span>);</span><br><span class="line">    <span class="comment">// 必须指定__TypeId__，值为全类名</span></span><br><span class="line">    messageProperties.getHeaders().put(<span class="string">"__TypeId__"</span>,<span class="string">"com.enbuys.spring.bean.User"</span>);</span><br><span class="line">    Message message = <span class="keyword">new</span> Message(userJson.getBytes(),messageProperties);</span><br><span class="line"></span><br><span class="line">    rabbitTemplate.send(<span class="string">"spring.ann.direct"</span>,<span class="string">"ann.direct"</span>,message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里最重要一点，添加Header，<code>put(&quot;__TypeId__&quot;,&quot;com.enbuys.spring.bean.User&quot;)</code>，其中键是固定的，值为全限定类名</p>
<p><strong>3.测试</strong></p>
<p><img src="/image/1577433001376.png" alt="1577433001376"></p>
<p>成功消费</p>
<p><strong>4.注意事项</strong></p>
<ul>
<li>实体类必须添加有参构造方法喝无参构造</li>
</ul>
<h4 id="转ObjecBean优化"><a href="#转ObjecBean优化" class="headerlink" title="转ObjecBean优化"></a>转ObjecBean优化</h4><p>在上一节，我们使用在Message Header添加特殊信息的方式进行消息转换，可以发现每次都需要写全限定类名，耦合度高还不方便，这里我们进行改造</p>
<p><strong>1.ListenerContainer改造</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建消息监听适配器</span></span><br><span class="line">MessageListenerAdapter adapter = <span class="keyword">new</span> MessageListenerAdapter(<span class="keyword">new</span> MyAdapter());</span><br><span class="line">adapter.setDefaultListenerMethod(<span class="string">"consumerMessage"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Json转换</span></span><br><span class="line">Jackson2JsonMessageConverter converter = <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">DefaultJackson2JavaTypeMapper mapper = <span class="keyword">new</span> DefaultJackson2JavaTypeMapper();</span><br><span class="line"></span><br><span class="line">Map&lt;String,Class&lt;?&gt;&gt; idClassMapping = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">idClassMapping.put(<span class="string">"user"</span>,User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">mapper.setIdClassMapping(idClassMapping);</span><br><span class="line">converter.setJavaTypeMapper(mapper);</span><br><span class="line"><span class="comment">// 设置转换器</span></span><br><span class="line">adapter.setMessageConverter(converter);</span><br><span class="line"></span><br><span class="line">container.setMessageListener(adapter);</span><br></pre></td></tr></table></figure>

<p>这里添加了DefaultJackson2JavaTypeMapper，用来配置id与Bean的关系，然后再发送消息时，就只需发现id即可，消息传输时就会根据映射关系转换。</p>
<p>DefaultJackson2JavaTypeMapper -&gt; Jackson2JsonMessageConverter -&gt; MessageListenerAdapter -&gt; SimpleMessageListenerContainer</p>
<p>Java类型映射器 -&gt; 消息转换器 -&gt; 消息监听映射器 -&gt; 消息监听容器</p>
<p><strong>2.改造发送消息的测试类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendUserMessage2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">"pacee"</span>);</span><br><span class="line">    String userJson = JSONObject.toJSONString(user);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建消息</span></span><br><span class="line">    <span class="comment">// 配置json格式请求</span></span><br><span class="line">    MessageProperties messageProperties = <span class="keyword">new</span> MessageProperties();</span><br><span class="line">    messageProperties.setContentType(<span class="string">"application/json"</span>);</span><br><span class="line">    <span class="comment">// 必须指定__TypeId__，值为全类名</span></span><br><span class="line">    messageProperties.getHeaders().put(<span class="string">"__TypeId__"</span>,<span class="string">"user"</span>);</span><br><span class="line">    Message message = <span class="keyword">new</span> Message(userJson.getBytes(),messageProperties);</span><br><span class="line"></span><br><span class="line">    rabbitTemplate.send(<span class="string">"spring.ann.direct"</span>,<span class="string">"ann.direct"</span>,message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，这里put的值就为刚刚设置的id</p>
<p><strong>3.测试</strong></p>
<p><img src="/image/1577433592956.png" alt="1577433592956"></p>
<p>成功消费</p>
<h3 id="ContentTypeDelegatingMessageConverter"><a href="#ContentTypeDelegatingMessageConverter" class="headerlink" title="ContentTypeDelegatingMessageConverter"></a>ContentTypeDelegatingMessageConverter</h3><p>经过上面转换器的学习，可以发现每次都只设置了一个转换器，要么是自定义的转换器，要么是Json转换器，那么能不能同时都用呢，这里<code>ContentTypeDelegatingMessageConverter</code>，就登场了，他是一个非常强大的转换器，可以根据请求头，进行不同场景使用不同的转换器，接下来我们通过代码进行探究</p>
<p><strong>1.修改Container</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SimpleMessageListenerContainer <span class="title">simpleMessageListenerContainer3</span><span class="params">(ConnectionFactory connectionFactory)</span></span>&#123;</span><br><span class="line">    SimpleMessageListenerContainer container = <span class="keyword">new</span> SimpleMessageListenerContainer(connectionFactory);</span><br><span class="line">    container.setQueueNames(<span class="string">"spring.ann.direct.queue"</span>); <span class="comment">// 通过名字设置队列</span></span><br><span class="line">    container.setConcurrentConsumers(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建消息监听适配器</span></span><br><span class="line">    MessageListenerAdapter adapter = <span class="keyword">new</span> MessageListenerAdapter(<span class="keyword">new</span> MyAdapter());</span><br><span class="line">    adapter.setDefaultListenerMethod(<span class="string">"consumerMessage"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用全局转换器</span></span><br><span class="line">    ContentTypeDelegatingMessageConverter convert = <span class="keyword">new</span> ContentTypeDelegatingMessageConverter();</span><br><span class="line">    <span class="comment">//根据不同的contentType添加相应的消息转换器</span></span><br><span class="line">    <span class="comment">//addDelegate(String contentType, MessageConverter messageConverter)</span></span><br><span class="line">    MyConverter textConvert = <span class="keyword">new</span> MyConverter();</span><br><span class="line">    convert.addDelegate(<span class="string">"text"</span>, textConvert);</span><br><span class="line">    convert.addDelegate(<span class="string">"html/text"</span>, textConvert);</span><br><span class="line">    convert.addDelegate(<span class="string">"xml/text"</span>, textConvert);</span><br><span class="line">    convert.addDelegate(<span class="string">"text/plain"</span>, textConvert);</span><br><span class="line"></span><br><span class="line">    Jackson2JsonMessageConverter jsonConvert = <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">    convert.addDelegate(<span class="string">"json"</span>, jsonConvert);</span><br><span class="line">    convert.addDelegate(<span class="string">"application/json"</span>, jsonConvert);</span><br><span class="line"></span><br><span class="line">    ImageMessageConverter imageConverter = <span class="keyword">new</span> ImageMessageConverter();</span><br><span class="line">    convert.addDelegate(<span class="string">"image/jpg"</span>, imageConverter);</span><br><span class="line">    convert.addDelegate(<span class="string">"image"</span>, imageConverter);</span><br><span class="line"></span><br><span class="line">    adapter.setMessageConverter(convert);</span><br><span class="line">    container.setMessageListener(adapter);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置转换器</span></span><br><span class="line">    adapter.setMessageConverter(convert);</span><br><span class="line"></span><br><span class="line">    container.setMessageListener(adapter);</span><br><span class="line">    <span class="keyword">return</span> container;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以根据代码看到，通过不同的请求头，配置了不同的转换器，这里我们对新添加的ImageMessageConverter进行测试</p>
<p><strong>2.创建ImageMessageConverter</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageMessageConverter</span> <span class="keyword">implements</span> <span class="title">MessageConverter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Message <span class="title">toMessage</span><span class="params">(Object object, MessageProperties messageProperties)</span> <span class="keyword">throws</span> MessageConversionException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">fromMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> MessageConversionException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"-----------Image MessageConverter----------"</span>);</span><br><span class="line">        <span class="comment">// 使用File传输，所以要将Message转成File</span></span><br><span class="line">        String fileName = <span class="string">"imageMessageConverter.jpg"</span>;</span><br><span class="line">        String path = <span class="string">"d:/"</span> + fileName;</span><br><span class="line">        File file = <span class="keyword">new</span> File(path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将字节流数据拷贝</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Files.copy(<span class="keyword">new</span> ByteArrayInputStream(message.getBody()),file.toPath());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里主要是对传输的文件进行了拷贝，并返回File</p>
<p><strong>3.修改委派类MyAdapter</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收File格式的</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumerMessage</span><span class="params">(File file)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"fileMessage : "</span> + file.getPath());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加File形式的入参</p>
<p><strong>4.发送消息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendFileMessage</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span>[] body = Files.readAllBytes(Paths.get(<span class="string">"E:\\pic"</span>, <span class="string">"photo.jpg"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建消息</span></span><br><span class="line">    <span class="comment">// 配置json格式请求</span></span><br><span class="line">    MessageProperties messageProperties = <span class="keyword">new</span> MessageProperties();</span><br><span class="line">    messageProperties.setContentType(<span class="string">"image/jpg"</span>);</span><br><span class="line">    Message message = <span class="keyword">new</span> Message(body,messageProperties);</span><br><span class="line"></span><br><span class="line">    rabbitTemplate.send(<span class="string">"spring.ann.direct"</span>,<span class="string">"ann.direct"</span>,message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里从本地取一张图片，并设置请求头尾<code>image/jpg</code></p>
<p><strong>5.测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ImageMessageConverter imageConverter = <span class="keyword">new</span> ImageMessageConverter();</span><br><span class="line">convert.addDelegate(<span class="string">"image/jpg"</span>, imageConverter);</span><br><span class="line">convert.addDelegate(<span class="string">"image"</span>, imageConverter);</span><br></pre></td></tr></table></figure>

<p>按照我们的配置，对于image格式的请求头，会走我们自定义的Image转换器，然后拷贝文件，输出文件路径</p>
<p><img src="/image/1577435022238.png" alt="1577435022238"></p>
<p>控制台成功输出文件路径</p>
<p><img src="/image/1577435037828.png" alt="1577435037828"></p>
<p>文件成功拷贝</p>
<h3 id="源码查看-1"><a href="#源码查看-1" class="headerlink" title="源码查看"></a>源码查看</h3><p>这时我们可以看一看这两个<code>MessageConverter</code>的实现类</p>
<p><code>Jackson2JsonMessageConverter</code>的话其实很简单，我们直接看<code>toMessage()</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">fromMessage</span><span class="params">(Message message)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> MessageConversionException </span>&#123;</span><br><span class="line">   Object content = <span class="keyword">null</span>;</span><br><span class="line">   MessageProperties properties = message.getMessageProperties();</span><br><span class="line">   <span class="keyword">if</span> (properties != <span class="keyword">null</span>) &#123;</span><br><span class="line">      String contentType = properties.getContentType();</span><br><span class="line">      <span class="keyword">if</span> (contentType != <span class="keyword">null</span> &amp;&amp; contentType.contains(<span class="string">"json"</span>)) &#123;</span><br><span class="line">         String encoding = properties.getContentEncoding();</span><br><span class="line">         <span class="keyword">if</span> (encoding == <span class="keyword">null</span>) &#123;</span><br><span class="line">            encoding = getDefaultCharset();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (getClassMapper() == <span class="keyword">null</span>) &#123;</span><br><span class="line">               JavaType targetJavaType = getJavaTypeMapper()</span><br><span class="line">                     .toJavaType(message.getMessageProperties());</span><br><span class="line">               content = convertBytesToObject(message.getBody(),</span><br><span class="line">                     encoding, targetJavaType);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">               Class&lt;?&gt; targetClass = getClassMapper().toClass(</span><br><span class="line">                     message.getMessageProperties());</span><br><span class="line">               content = convertBytesToObject(message.getBody(),</span><br><span class="line">                     encoding, targetClass);</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MessageConversionException(</span><br><span class="line">                  <span class="string">"Failed to convert Message content"</span>, e);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (log.isWarnEnabled()) &#123;</span><br><span class="line">            log.warn(<span class="string">"Could not convert incoming message with content-type ["</span></span><br><span class="line">                  + contentType + <span class="string">"], 'json' keyword missing."</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (content == <span class="keyword">null</span>) &#123;</span><br><span class="line">      content = message.getBody();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>判断请求头是否带有<code>json</code>，如果没有直接使用<code>byte</code>二进制形式返回，即原形式</li>
<li>如果有，进行类型转换</li>
</ul>
<p>更详细的转换逻辑这里就不看了</p>
<p><strong>接着看一下<code>ContentTypeDelegatingMessageConverter</code>的源码</strong></p>
<p>还是先看<code>toMessage()</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Message <span class="title">toMessage</span><span class="params">(Object object, MessageProperties messageProperties)</span> </span>&#123;</span><br><span class="line">   String contentType = messageProperties.getContentType();</span><br><span class="line">   <span class="keyword">return</span> getConverterForContentType(contentType).toMessage(object, messageProperties);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现，他本身并没有实现方法，而是将消息委派给具体的<code>MessageConverter</code>进行消息转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> MessageConverter <span class="title">getConverterForContentType</span><span class="params">(String contentType)</span> </span>&#123;</span><br><span class="line">   MessageConverter delegate = getDelegates().get(contentType);</span><br><span class="line">   <span class="keyword">if</span> (delegate == <span class="keyword">null</span>) &#123;</span><br><span class="line">      delegate = <span class="keyword">this</span>.defaultConverter;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (delegate == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> MessageConversionException(<span class="string">"No delegate converter is specified for content type "</span> + contentType);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> delegate;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取具体<code>MessageConverter</code>的方法也很简单，根据<code>Delegates</code>中设置的请求头进行获取</p>
<p>这里如果没有具体的实现，会使用默认的<code>MessageConverter</code>，<code>this.defaultConverter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> MessageConverter defaultConverter;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ContentTypeDelegatingMessageConverter</span><span class="params">(MessageConverter defaultConverter)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.defaultConverter = defaultConverter;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ContentTypeDelegatingMessageConverter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(<span class="keyword">new</span> SimpleMessageConverter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上面的关系，可以发现默认<code>MessageConverter</code>是<code>SimpleMessageConverter</code></p>
<p>其实最后还是使用<code>byte[]</code>二进制的方式</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/rabbitmq/" rel="tag"># rabbitmq</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/12/27/rb12-RabbitMQ%E6%95%B4%E5%90%88-SpringAMQP%E4%B8%80/" rel="next" title="RabbitMQ整合-SpringAMQP(一)">
                <i class="fa fa-chevron-left"></i> RabbitMQ整合-SpringAMQP(一)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/12/30/rb14-RabbitMQ%E6%95%B4%E5%90%88-SpringBoot/" rel="prev" title="RabbitMQ整合-SpringBoot">
                RabbitMQ整合-SpringBoot <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="PAcee" />
            
              <p class="site-author-name" itemprop="name">PAcee</p>
              <p class="site-description motion-element" itemprop="description">学习 笔记</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">60</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#SimpleMessageListenerContainer"><span class="nav-number">1.</span> <span class="nav-text">SimpleMessageListenerContainer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#特性说明"><span class="nav-number">1.1.</span> <span class="nav-text">特性说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SimpleMessageListenerContainer使用"><span class="nav-number">1.2.</span> <span class="nav-text">SimpleMessageListenerContainer使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MessageListenerAdapter"><span class="nav-number">2.</span> <span class="nav-text">MessageListenerAdapter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#快速使用"><span class="nav-number">2.1.</span> <span class="nav-text">快速使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#源码查看"><span class="nav-number">2.2.</span> <span class="nav-text">源码查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用配置"><span class="nav-number">2.3.</span> <span class="nav-text">常用配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方法名修改"><span class="nav-number">2.3.1.</span> <span class="nav-text">方法名修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法参数类型修改"><span class="nav-number">2.3.2.</span> <span class="nav-text">方法参数类型修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#队列与方法对应"><span class="nav-number">2.3.3.</span> <span class="nav-text">队列与方法对应</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MessageConverter"><span class="nav-number">3.</span> <span class="nav-text">MessageConverter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Jackson2JsonMessageConverter"><span class="nav-number">3.1.</span> <span class="nav-text">Jackson2JsonMessageConverter</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Message转Json"><span class="nav-number">3.1.1.</span> <span class="nav-text">Message转Json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Message转ObjecBean"><span class="nav-number">3.1.2.</span> <span class="nav-text">Message转ObjecBean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#转ObjecBean优化"><span class="nav-number">3.1.3.</span> <span class="nav-text">转ObjecBean优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ContentTypeDelegatingMessageConverter"><span class="nav-number">3.2.</span> <span class="nav-text">ContentTypeDelegatingMessageConverter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#源码查看-1"><span class="nav-number">3.3.</span> <span class="nav-text">源码查看</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PAcee</span>

  
</div>





        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
