<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="springsecurity," />










<meta name="description" content="基本的Token配置在之前的OAuth学习中，我们都是使用它默认生成的Token，那么我们这一节就是来自定义Token的一些配置。 配置Token配置Token需要继承AuthorizationServerConfigurerAdapter类 12345678910111213141516171819202122232425262728293031323334353637383940@Config">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringSecurity20-OAuth-JWT">
<meta property="og:url" content="http://yoursite.com/2020/01/20/ss20-SpringSecurity20-OAuth-JWT/index.html">
<meta property="og:site_name" content="PAcee Hub">
<meta property="og:description" content="基本的Token配置在之前的OAuth学习中，我们都是使用它默认生成的Token，那么我们这一节就是来自定义Token的一些配置。 配置Token配置Token需要继承AuthorizationServerConfigurerAdapter类 12345678910111213141516171819202122232425262728293031323334353637383940@Config">
<meta property="og:image" content="http://yoursite.com/image/1579489367652.png">
<meta property="og:image" content="http://yoursite.com/image/1579489675866.png">
<meta property="og:image" content="http://yoursite.com/image/1579489701437.png">
<meta property="og:image" content="http://yoursite.com/image/1579501877444.png">
<meta property="og:image" content="http://yoursite.com/image/1579502052620.png">
<meta property="og:image" content="http://yoursite.com/image/1579502135232.png">
<meta property="og:image" content="http://yoursite.com/image/1579502165964.png">
<meta property="og:image" content="http://yoursite.com/image/1579502381834.png">
<meta property="og:image" content="http://yoursite.com/image/1579502408740.png">
<meta property="og:image" content="http://yoursite.com/image/1579504361995.png">
<meta property="og:image" content="http://yoursite.com/image/1579504443772.png">
<meta property="og:image" content="http://yoursite.com/image/1579505360622.png">
<meta property="article:published_time" content="2020-01-20T08:37:45.000Z">
<meta property="article:modified_time" content="2020-01-20T08:50:04.636Z">
<meta property="article:author" content="PAcee">
<meta property="article:tag" content="springsecurity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/image/1579489367652.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/01/20/ss20-SpringSecurity20-OAuth-JWT/"/>





  <title>SpringSecurity20-OAuth-JWT | PAcee Hub</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">PAcee Hub</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学习 笔记</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/20/ss20-SpringSecurity20-OAuth-JWT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="PAcee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PAcee Hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">SpringSecurity20-OAuth-JWT</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-20T16:37:45+08:00">
                2020-01-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/springsecurity/" itemprop="url" rel="index">
                    <span itemprop="name">springsecurity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="基本的Token配置"><a href="#基本的Token配置" class="headerlink" title="基本的Token配置"></a>基本的Token配置</h2><p>在之前的OAuth学习中，我们都是使用它默认生成的Token，那么我们这一节就是来自定义Token的一些配置。</p>
<h3 id="配置Token"><a href="#配置Token" class="headerlink" title="配置Token"></a>配置Token</h3><p>配置Token需要继承<code>AuthorizationServerConfigurerAdapter</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationServerConfig</span> <span class="keyword">extends</span> <span class="title">AuthorizationServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService myUserDetailService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 如果继承AuthorizationServerConfigurerAdapter这个类，就必须配置下面两个对象</span></span><br><span class="line">        <span class="comment">// 认证管理器和UserDetailsService</span></span><br><span class="line">        <span class="comment">// Security5之后，认证管理器无法自动注入，需要向容器中添加，方式为继承WebServerConfigurerAdapter重新方法</span></span><br><span class="line">        endpoints.authenticationManager(authenticationManager)</span><br><span class="line">                .userDetailsService(myUserDetailService);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        clients.inMemory()</span><br><span class="line">                    .withClient(<span class="string">"enbuys"</span>) <span class="comment">// client id</span></span><br><span class="line">                    <span class="comment">// client secret 必须使用密码进行加密</span></span><br><span class="line">                    .secret(passwordEncoder.encode(<span class="string">"enbuys"</span>))</span><br><span class="line">                    <span class="comment">// token过期时间</span></span><br><span class="line">                    .accessTokenValiditySeconds(<span class="number">6000</span>)</span><br><span class="line">                    <span class="comment">// 可以使用的授权模式</span></span><br><span class="line">                    .authorizedGrantTypes(<span class="string">"password"</span>,<span class="string">"refresh_token"</span>)</span><br><span class="line">                    <span class="comment">// 配置授权类型，设置了这个，发送请求如果不同会报错</span></span><br><span class="line">                    .scopes(<span class="string">"all"</span>)</span><br><span class="line">                .and() <span class="comment">// 配置第二个客户端</span></span><br><span class="line">                    .withClient(<span class="string">"test"</span>)</span><br><span class="line">                    .secret(passwordEncoder.encode(<span class="string">"test"</span>))</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由代码注释可见，继承此类，<strong>必须重写方法配置<code>AuthorizationManager</code>和<code>UserDetailsService</code></strong>，其中<code>UserDetailsService</code>我们之前已经实现，直接注入即可，<code>AuthorizationManager</code>在SpringBoot2.x，Security5.x之后需要我们向容器注入，否则会出现无法找到类的情况，所以我们下一步需要向容器注入<code>AuthorizationManager</code>。</p>
<p>还有一点需要注意的是，在SpringBoot2.x，Security5.x之后，客户端密码即<code>clientSecret</code>需要进行加密，不然无法匹配。</p>
<a id="more"></a>
<h3 id="向容器中注入AuthenticationManager"><a href="#向容器中注入AuthenticationManager" class="headerlink" title="向容器中注入AuthenticationManager"></a>向容器中注入AuthenticationManager</h3><p>这里我们使用之前配置<code>basic</code>登录方式的<code>AppSecurityConfig</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthenticationManager <span class="title">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.httpBasic();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样其实已经配置好了，但是还有有一点可以配置的，就是Token的保存位置。</p>
<h3 id="使用Redis存储Token"><a href="#使用Redis存储Token" class="headerlink" title="使用Redis存储Token"></a>使用Redis存储Token</h3><p>我们之前都是使用默认内存形式保存的Token，这样应用一重启就失效了，现在我们改成使用Redis保存，为何不用Mysql我就不赘述了。</p>
<p>使用方式也很简单，首先向容器注入<code>RedisTokenStore</code>存储器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenStoreConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisConnectionFactory redisConnectionFactory;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTokenStore <span class="title">redisTokenStore</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisTokenStore(redisConnectionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再刚刚配置Token的地方配置<code>TokenStore</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationServerConfig</span> <span class="keyword">extends</span> <span class="title">AuthorizationServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenStore tokenStore;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        endpoints.authenticationManager(authenticationManager)</span><br><span class="line">                .userDetailsService(myUserDetailService)</span><br><span class="line">            	<span class="comment">// 配置TokenStore</span></span><br><span class="line">                .tokenStore(tokenStore);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ···</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里Redis的配置可以自行在<code>application.properties</code>中配置</p>
<h3 id="启动测试"><a href="#启动测试" class="headerlink" title="启动测试"></a>启动测试</h3><p><img src="/image/1579489367652.png" alt="1579489367652"></p>
<p>发送请求后，可以看到超时时间是我们设置的60秒</p>
<p><img src="/image/1579489675866.png" alt="1579489675866"></p>
<p>可以成功获取信息，并且Redis中保存了数据</p>
<p><img src="/image/1579489701437.png" alt="1579489701437"></p>
<h2 id="使用JWT替换默认Token"><a href="#使用JWT替换默认Token" class="headerlink" title="使用JWT替换默认Token"></a>使用JWT替换默认Token</h2><h3 id="JWT是什么"><a href="#JWT是什么" class="headerlink" title="JWT是什么"></a>JWT是什么</h3><p>首先我们要先了解什么是JWT，Json Web Token，它是一种特殊的Token，有以下三个特点概况：</p>
<ul>
<li>自包含：这个令牌中是<strong>包括一些信息</strong>的，而不是像普通的Token使用<code>UUID</code>随机生成，拿到这个令牌，<strong>进行解析就可以获取到一些信息</strong>，比如用户信息请求信息等。这样的好处就是不用再服务端保存Token了，普通的Token保存在Redis或者Mysql中，<strong>如果数据库挂了，那么那些Token也就失效了</strong>，使用JWT就不会出现这种情况。也不用担心分布式集群时的Session共享问题。</li>
<li>可扩展：它除了默认的信息外，我们可以往里面添加自定义的信息，就比如<code>HTTP</code>请求向请求头中添加自定义请求头一样。</li>
<li>密签：在生成JWT的时候，我们可以添加一个秘钥，他是一个签名，而不是加密，就是别人可以破解了解你这里面保存了什么东西，但是别人<strong>不能篡改</strong>。秘钥很重要，如果泄露别人就可以仿照我们的令牌进行不当操作。</li>
</ul>
<h3 id="实现JWT"><a href="#实现JWT" class="headerlink" title="实现JWT"></a>实现JWT</h3><p>在SpringSecurity OAuth中实现JWT很简单，我们之前看过源码，在生成Token的时候使用的是<code>DefaultTokenServices</code>生成，<code>UUID</code>的形式，我们想要生成JWT就需要向容器添加<code>TokenEnhancer</code>增强类，使默认生成的Token变成JWT：</p>
<ul>
<li>配置<code>JwtAccessTokenConverter</code>：本质是<code>TokenEnhancer</code>，作用是将默认生成的token做进一步处理使其成为一个JWT。</li>
<li>配置<code>TokenStore</code>：和<code>RedisTokenStore</code>一样，JWT也有一个<code>JWTTokenStore</code>，因为我们其实并不需要保存JWT所以其实这个实现类就是什么都不做，不做持久化或者向添加到内存</li>
<li>将<code>TokenStore</code>以及<code>JwtAccessTokenConverter</code>添加到认证服务器配置中</li>
</ul>
<p><strong>配置 JwtAccessTokenConverter 与 TokenStore</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenStoreConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisConnectionFactory redisConnectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JwtTokenStore <span class="title">jwtTokenStore</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 实例化需要添加JwtConverter</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JwtTokenStore(jwtAccessTokenConverter());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JwtAccessTokenConverter <span class="title">jwtAccessTokenConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JwtAccessTokenConverter jwtAccessTokenConverter = <span class="keyword">new</span> JwtAccessTokenConverter();</span><br><span class="line">        <span class="comment">// 设置签名</span></span><br><span class="line">        jwtAccessTokenConverter.setSigningKey(<span class="string">"enbuys"</span>);</span><br><span class="line">        <span class="keyword">return</span> jwtAccessTokenConverter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*@Bean</span></span><br><span class="line"><span class="comment">    public RedisTokenStore redisTokenStore()&#123;</span></span><br><span class="line"><span class="comment">        return new RedisTokenStore(redisConnectionFactory);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>将TokenStore以及JwtAccessTokenConverter 添加到认证服务器配置中</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationServerConfig</span> <span class="keyword">extends</span> <span class="title">AuthorizationServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenStore tokenStore;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAccessTokenConverter jwtAccessTokenConverter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        endpoints.authenticationManager(authenticationManager)</span><br><span class="line">                .userDetailsService(myUserDetailService)</span><br><span class="line">                .tokenStore(tokenStore) <span class="comment">// 添加Token存储机制</span></span><br><span class="line">                .accessTokenConverter(jwtAccessTokenConverter) <span class="comment">// 添加JWT增强器</span></span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    ···</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>然后启动测试</strong></p>
<p><img src="/image/1579501877444.png" alt="1579501877444"></p>
<p>会发现Token变了，变的很长一串就是JWT了，而且每次请求不管是否超时都会重新生成新的JWT，如何查看这个Token中的内容呢？找一个解析网站解析：<a href="https://www.jsonwebtoken.io/" target="_blank" rel="noopener">https://www.jsonwebtoken.io/</a></p>
<p><img src="/image/1579502052620.png" alt="1579502052620"></p>
<p>然后我们拿着Token获取用户信息</p>
<p><img src="/image/1579502135232.png" alt="1579502135232"></p>
<p>发现没有任何返回信息，为何？看看代码</p>
<p><img src="/image/1579502165964.png" alt="1579502165964"></p>
<p>这里我们使用的是<code>Authorization</code>中的<code>Principal</code>信息，可能因为信息不正确没有映射成功，我们请求<code>/me</code>看看</p>
<p><img src="/image/1579502381834.png" alt="1579502381834"></p>
<p><img src="/image/1579502408740.png" alt="1579502408740"></p>
<p>因为principal是一个字符串，所以没有返回。</p>
<p>这里JWT再传给资源服务器获取信息的时候，会将其解析并封装成SpringSecurity Authorization，而不是它本身包含的那些信息，这里需要根据业务需求去获取哪些信息，比如用户信息就保存在<code>userAuthorization</code>中</p>
<h2 id="JWT扩展"><a href="#JWT扩展" class="headerlink" title="JWT扩展"></a>JWT扩展</h2><h3 id="向JWT中添加附加信息"><a href="#向JWT中添加附加信息" class="headerlink" title="向JWT中添加附加信息"></a>向JWT中添加附加信息</h3><p>就是类似像请求头中添加自定义信息一样，我们也可以往JWT中添加自定义信息，实现也非常简单</p>
<p>其原理就，自己写一个Token增强器，在Token生成后，对Token进行添加自定义信息。</p>
<h4 id="实现自定义Token增强器"><a href="#实现自定义Token增强器" class="headerlink" title="实现自定义Token增强器"></a>实现自定义Token增强器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJwtTokenEnhancer</span> <span class="keyword">implements</span> <span class="title">TokenEnhancer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OAuth2AccessToken <span class="title">enhance</span><span class="params">(OAuth2AccessToken accessToken, OAuth2Authentication authentication)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建自定义信息，Map形式</span></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"company"</span>,<span class="string">"enbuys"</span>);</span><br><span class="line">        <span class="comment">// 向AccessToken中添加自定义信息</span></span><br><span class="line">        ((DefaultOAuth2AccessToken)accessToken).setAdditionalInformation(map);</span><br><span class="line">        <span class="keyword">return</span> accessToken;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置认证规则"><a href="#配置认证规则" class="headerlink" title="配置认证规则"></a>配置认证规则</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationServerConfig</span> <span class="keyword">extends</span> <span class="title">AuthorizationServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenStore tokenStore;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAccessTokenConverter jwtAccessTokenConverter;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenEnhancer myJwtTokenEnhancer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ···</span><br><span class="line">        <span class="comment">// 这里需要添加两个增强器，所以要使用增强器链添加</span></span><br><span class="line">        List&lt;TokenEnhancer&gt; tokenEnhancerList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        tokenEnhancerList.add(myJwtTokenEnhancer); <span class="comment">//自定义增强器需要放在前面</span></span><br><span class="line">        tokenEnhancerList.add(jwtAccessTokenConverter);</span><br><span class="line">        TokenEnhancerChain chain = <span class="keyword">new</span> TokenEnhancerChain();</span><br><span class="line">        chain.setTokenEnhancers(tokenEnhancerList);</span><br><span class="line">        endpoints.tokenEnhancer(chain);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    ···</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我省略了之前的代码，对于需要添加多个增强器的，必须使用增强器链的形式，还有一点就是<strong>自定义的增强器要放在<code>JWTConverter</code>前面，不然不会生效！</strong></p>
<h4 id="启动测试-1"><a href="#启动测试-1" class="headerlink" title="启动测试"></a>启动测试</h4><p>发送完，再看一下解析</p>
<p><img src="/image/1579504361995.png" alt="1579504361995"></p>
<p>会发现多出来一个我们自定义的信息，然后我们请求<code>/me</code>接口，看看<code>Authorization</code>中的信息</p>
<p><img src="/image/1579504443772.png" alt="1579504443772"></p>
<p>这里会发现是没有我们添加的附加信息的，所以我们需要一些操作来获取附加信息</p>
<h3 id="服务器获取JWT附加信息"><a href="#服务器获取JWT附加信息" class="headerlink" title="服务器获取JWT附加信息"></a>服务器获取JWT附加信息</h3><p>我们需要借助<code>jjwt</code>这个插件实现获取，其实原理就是将JWT解析，然后存到Map里</p>
<p><strong>加入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>从请求头中获取到JWT，并利用Jwts工具借助<code>密钥</code>解析获得到扩展信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/getMyJwt"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getMyJwt</span><span class="params">(Authentication authentication,HttpServletRequest request)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">    <span class="comment">//从请求头中获取到JWT</span></span><br><span class="line">    String token = StringUtils.substringAfter(request.getHeader(<span class="string">"Authorization"</span>), <span class="string">"bearer "</span>);</span><br><span class="line">    <span class="comment">//借助密钥对JWT进行解析,注意由于JWT生成时编码格式用的UTF-8（看源码可以追踪到）</span></span><br><span class="line">    <span class="comment">//但Jwts工具用到的默认编码格式不是，所以要设置其编码格式为UTF-8</span></span><br><span class="line">    String signKey = <span class="string">"enbuys"</span>;</span><br><span class="line">    Claims claims = Jwts.parser()</span><br><span class="line">            .setSigningKey(signKey.getBytes(<span class="string">"UTF-8"</span>))</span><br><span class="line">            .parseClaimsJws(token).getBody();</span><br><span class="line">    <span class="comment">//取出扩展信息，并打印</span></span><br><span class="line">    String company = (String) claims.get(<span class="string">"company"</span>);</span><br><span class="line">    <span class="keyword">return</span> company;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/image/1579505360622.png" alt="1579505360622"></p>
<h2 id="使用JWT实现SSO"><a href="#使用JWT实现SSO" class="headerlink" title="使用JWT实现SSO"></a>使用JWT实现SSO</h2><p>SSO单点登录，就是在淘宝登录了，我们从淘宝点链接跳到天猫，会自动登录，不需要再次登录。</p>
<h3 id="SpringSecurity-OAuth实现方式"><a href="#SpringSecurity-OAuth实现方式" class="headerlink" title="SpringSecurity OAuth实现方式"></a>SpringSecurity OAuth实现方式</h3><p>这里简单说一下，就不放代码了</p>
<ul>
<li>首先需要创建一个认证服务器应用，用来做认证</li>
<li>然后创建两个客户端，用来当做淘宝和天猫</li>
</ul>
<p>单点登录的配置很简单，启动器类添加一个注解，然后再配置文件中配置即可！</p>
<h4 id="添加注解"><a href="#添加注解" class="headerlink" title="添加注解"></a>添加注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableOAuth</span>2Sso <span class="comment">// 开启单点登录</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SsoClient1Application</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<p><code>@EnableOAuth2Sso</code> 主要是这个注解开启OAuth2单点登录</p>
<h4 id="配置文件配置"><a href="#配置文件配置" class="headerlink" title="配置文件配置"></a>配置文件配置</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单点登录配置</span></span><br><span class="line"><span class="meta">security.oauth2.client.clientId</span> = <span class="string">app1</span></span><br><span class="line"><span class="meta">security.oauth2.client.clientSecret</span> = <span class="string">app1</span></span><br><span class="line"><span class="meta">security.oauth2.client.user-authorization-uri</span> = <span class="string">http://127.0.0.1:9999/server/oauth/authorize</span></span><br><span class="line"><span class="meta">security.oauth2.client.access-token-uri</span> = <span class="string">http://127.0.0.1:9999/server/oauth/token</span></span><br><span class="line"><span class="meta">security.oauth2.resource.jwt.key-uri</span> = <span class="string">http://127.0.0.1:9999/server/oauth/token_key</span></span><br><span class="line"><span class="comment"># Security5之后需要配置</span></span><br><span class="line"><span class="meta">security.oauth2.resource.user-info-uri</span>= <span class="string">http://127.0.0.1:9999/server/user</span></span><br><span class="line"><span class="meta">security.oauth2.resource.token-info-uri</span>= <span class="string">http://127.0.0.1:9999/server/oauth/check_token</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用配置</span></span><br><span class="line"><span class="meta">server.port</span> = <span class="string">8080</span></span><br><span class="line"><span class="meta">server.context-path</span> = <span class="string">/app1</span></span><br></pre></td></tr></table></figure>

<p>这只是最基本的配置，还有很多需要自己去实现，比如：</p>
<ul>
<li>自定义的登录页面</li>
<li>自动授权</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/springsecurity/" rel="tag"># springsecurity</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/01/19/ss19-SpringSecurity19-OAuth-%E9%87%8D%E6%9E%84%E4%B8%89%E7%A7%8D%E7%99%BB%E5%BD%95/" rel="next" title="SpringSecurity19-OAuth-重构三种登录">
                <i class="fa fa-chevron-left"></i> SpringSecurity19-OAuth-重构三种登录
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/photo.jpg"
                alt="PAcee" />
            
              <p class="site-author-name" itemprop="name">PAcee</p>
              <p class="site-description motion-element" itemprop="description">学习 笔记</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">75</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本的Token配置"><span class="nav-number">1.</span> <span class="nav-text">基本的Token配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置Token"><span class="nav-number">1.1.</span> <span class="nav-text">配置Token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#向容器中注入AuthenticationManager"><span class="nav-number">1.2.</span> <span class="nav-text">向容器中注入AuthenticationManager</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Redis存储Token"><span class="nav-number">1.3.</span> <span class="nav-text">使用Redis存储Token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动测试"><span class="nav-number">1.4.</span> <span class="nav-text">启动测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用JWT替换默认Token"><span class="nav-number">2.</span> <span class="nav-text">使用JWT替换默认Token</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JWT是什么"><span class="nav-number">2.1.</span> <span class="nav-text">JWT是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现JWT"><span class="nav-number">2.2.</span> <span class="nav-text">实现JWT</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JWT扩展"><span class="nav-number">3.</span> <span class="nav-text">JWT扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#向JWT中添加附加信息"><span class="nav-number">3.1.</span> <span class="nav-text">向JWT中添加附加信息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#实现自定义Token增强器"><span class="nav-number">3.1.1.</span> <span class="nav-text">实现自定义Token增强器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置认证规则"><span class="nav-number">3.1.2.</span> <span class="nav-text">配置认证规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启动测试-1"><span class="nav-number">3.1.3.</span> <span class="nav-text">启动测试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务器获取JWT附加信息"><span class="nav-number">3.2.</span> <span class="nav-text">服务器获取JWT附加信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用JWT实现SSO"><span class="nav-number">4.</span> <span class="nav-text">使用JWT实现SSO</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringSecurity-OAuth实现方式"><span class="nav-number">4.1.</span> <span class="nav-text">SpringSecurity OAuth实现方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#添加注解"><span class="nav-number">4.1.1.</span> <span class="nav-text">添加注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置文件配置"><span class="nav-number">4.1.2.</span> <span class="nav-text">配置文件配置</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PAcee</span>

  
</div>





        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
